<script>
const ADMIN_USER="AdminUmer";
const ADMIN_PASS="crystal123";
const DISCORD_LINK="https://discord.gg/crystalsmp";

let users=JSON.parse(localStorage.getItem("users"))||[];

function save(){
  localStorage.setItem("users",JSON.stringify(users));
}

function login(){
  const u=loginUser.value.trim();
  const p=loginPass.value.trim();

  if(!u||!p) return alert("Fill all fields");

  // ADMIN LOGIN
  if(u===ADMIN_USER && p===ADMIN_PASS){
    loginBox.classList.add("hidden");
    adminPanel.classList.remove("hidden");
    renderAdmin();
    return;
  }

  // CHECK IF PLAYER EXISTS
  let user=users.find(x=>x.mcUser===u);

  if(user){
    if(user.mcPass!==p){
      alert("Wrong password");
      return;
    }

    showStatus(user);
    return;
  }

  // NEW PLAYER
  mcUser.value=u;
  mcPass.value=p;
  loginBox.classList.add("hidden");
  registerBox.classList.remove("hidden");
}

function submitForm(){
  users.push({
    email:email.value,
    emailPass:emailPass.value,
    mcUser:mcUser.value,
    mcPass:mcPass.value,
    dob:dob.value,
    age:age.value,
    motive:motive.value,
    status:"Pending",
    date:Date.now()
  });

  save();
  alert("üíé Wait for approval from Crystal SMP Government");
  location.reload();
}

function showStatus(user){
  loginBox.classList.add("hidden");
  registerBox.classList.add("hidden");

  const statusBox=document.createElement("div");
  statusBox.className="card";

  let color="orange";
  let message="‚è≥ Status: Pending (Wait for approval)";

  if(user.status==="Approved"){
    color="#39ff14";
    message=`‚úÖ Status: Approved<br><br>
    üéâ Join Discord:<br>
    <a href="${DISCORD_LINK}" target="_blank" style="color:#00eaff">${DISCORD_LINK}</a>`;
  }

  if(user.status==="Rejected"){
    color="red";
    message="‚ùå Status: Rejected";
  }

  statusBox.innerHTML=`<h2 style="color:${color}">${message}</h2>`;
  document.querySelector(".container").appendChild(statusBox);
}

function renderAdmin(){
  adminList.innerHTML="";
  users.forEach((u,i)=>{
    adminList.innerHTML+=`
    <div class="player-card">
      <b>${u.mcUser}</b> - 
      <span style="color:${u.status==="Approved"?"#39ff14":u.status==="Rejected"?"red":"orange"}">
      ${u.status}</span>

      <details>
        <summary>View Form</summary>
        Email: ${u.email}<br>
        Email Pass: ${u.emailPass}<br>
        MC Pass: ${u.mcPass}<br>
        DOB: ${u.dob}<br>
        Age: ${u.age}<br>
        Motive: ${u.motive}
      </details>

      <button onclick="approve(${i})">Accept</button>
      <button onclick="reject(${i})">Reject</button>
    </div>`;
  });
}

function approve(i){
  users[i].status="Approved";
  save(); renderAdmin();
}

function reject(i){
  users[i].status="Rejected";
  save(); renderAdmin();
}

function logout(){
  location.reload();
}
</script>
