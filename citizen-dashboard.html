<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Citizen Dashboard | Crystal SMP</title>
<style>
body { font-family: Arial, sans-serif; background:#111; color:#fff; }
header { text-align:center; padding:20px; background: #222; font-size:1.8rem; color:#FFD700; }
.container { max-width:900px; margin:20px auto; }
.card { background: rgba(255,255,255,0.1); padding:15px; margin:10px 0; border-radius:10px; cursor:pointer; transition:0.3s; }
.card:hover { background: rgba(255,255,255,0.2); }
button { padding:8px 12px; margin-top:10px; border:none; border-radius:6px; background:#39FF14; font-weight:bold; cursor:pointer; }
</style>
</head>
<body>
<header>Crystal SMP Citizen Dashboard</header>
<div class="container" id="dashboardContainer"></div>

<script>
const role = localStorage.getItem('loggedInRole');
if(!role){ alert("Login required"); window.location.href='citizen-login.html'; }

const container = document.getElementById('dashboardContainer');
const players = JSON.parse(localStorage.getItem('players')||'[]');

if(role==='player'){
  const username = localStorage.getItem('loggedInUser');
  const player = players.find(p=>p.username===username);
  if(player){
    container.innerHTML = `<div class="card">Welcome ${player.username} | ID: ${player.id}</div>
      <button onclick="window.location.href='citizen-profile.html?user=${player.username}'">View Profile</button>`;
  }
} else if(role==='admin' || role==='police'){
  if(players.length===0){
    container.innerHTML = "<p>No registered players yet.</p>";
  } else {
    // Search Bar
    container.innerHTML = '<input type="text" id="searchInput" placeholder="Search by name / ID..." style="width:100%;padding:10px;border-radius:6px;margin-bottom:15px;border:none;">';
    const listDiv = document.createElement('div');
    listDiv.id='playerList';
    container.appendChild(listDiv);

    function renderPlayers(filter=""){
      listDiv.innerHTML="";
      players.filter(p=>p.username.toLowerCase().includes(filter.toLowerCase()) || p.id.includes(filter)).forEach(p=>{
        const card = document.createElement('div');
        card.className='card';
        card.innerHTML=`${p.username} | ID: ${p.id} <button onclick="viewProfile('${p.username}')">View Profile</button>`;
        listDiv.appendChild(card);
      });
    }
    renderPlayers();

    document.getElementById('searchInput').addEventListener('input', e=>{
      renderPlayers(e.target.value);
    });
  }
}

function viewProfile(username){
  window.location.href='citizen-profile.html?user='+username;
}
</script>
</body>
</html>
